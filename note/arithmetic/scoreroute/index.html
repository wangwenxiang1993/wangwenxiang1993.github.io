<!doctype html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="shortcut icon" href="/img/favicon.ico"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="//cdn.bootcss.com/nprogress/0.2.0/nprogress.min.css" rel="stylesheet"/>
    <link rel="stylesheet" type="text/css" href="/css/style.css"/>
    <link rel="stylesheet" type="text/css" href="/css/font-awesome.min.css"/>
    <script src="/js/jquery-1.7.1.min.js"></script>
    <script src="//cdn.bootcss.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="//cdn.bootcss.com/nprogress/0.2.0/nprogress.min.js"></script>
    <title>winx&#39;blog</title>
</head>
<body>
<div class="animated" id="info-min">
    <div id="guide">
    <div class="guide-button " _href="/tags/index/">首页</div>
    <div class="guide-button " _href="/tags/tech/">技术</div>
    <!--<div class="guide-button " _href="/tags/life/">生活</div>-->
    <div class="guide-button " _href="/categories/read/">阅读</div>
    <img src="/img/photo.png">
</div>
</div>
<div id="wrap">
    
  
    
      <div id="big-title" style="color: #666">
    

  <div id="title-name">顺路程度算法</div><br>
  <div id="something">2018/05/18</div>
</div>
  <section id="content-specific">
    <article class="post">
        <div class="con"><h5 id="之前在做私车同行项目中，需要用一个分数值去表现司机和乘客行程的顺路匹配程度。以此来做一些类似于推荐和排序的需求。奈何于网络上没有找到相对满意的理论和工程实现。因此我们尝试从某些维度出发，将其赋予不同的权重值，通过参数的调节，达到一个相对满意的程度。"><a href="#之前在做私车同行项目中，需要用一个分数值去表现司机和乘客行程的顺路匹配程度。以此来做一些类似于推荐和排序的需求。奈何于网络上没有找到相对满意的理论和工程实现。因此我们尝试从某些维度出发，将其赋予不同的权重值，通过参数的调节，达到一个相对满意的程度。" class="headerlink" title="之前在做私车同行项目中，需要用一个分数值去表现司机和乘客行程的顺路匹配程度。以此来做一些类似于推荐和排序的需求。奈何于网络上没有找到相对满意的理论和工程实现。因此我们尝试从某些维度出发，将其赋予不同的权重值，通过参数的调节，达到一个相对满意的程度。"></a>之前在做私车同行项目中，需要用一个分数值去表现司机和乘客行程的顺路匹配程度。以此来做一些类似于推荐和排序的需求。奈何于网络上没有找到相对满意的理论和工程实现。因此我们尝试从某些维度出发，将其赋予不同的权重值，通过参数的调节，达到一个相对满意的程度。</h5><a id="more"></a>
<h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><h5 id="我们的需求当中，类似于顺风车场景，司机和乘客都有自己原本的出发地和到达地，并且司机和乘客为预约出发，但是我们的顺路算法不用考虑实时性以及路况信息。因此我们将算法分成了几个部分：基础分、时间、顺路、绕路、方向。其中除了方向以为，其他的维度都有一个权重值，并且所有权重相加等于1。最终的分数计算公式为："><a href="#我们的需求当中，类似于顺风车场景，司机和乘客都有自己原本的出发地和到达地，并且司机和乘客为预约出发，但是我们的顺路算法不用考虑实时性以及路况信息。因此我们将算法分成了几个部分：基础分、时间、顺路、绕路、方向。其中除了方向以为，其他的维度都有一个权重值，并且所有权重相加等于1。最终的分数计算公式为：" class="headerlink" title="我们的需求当中，类似于顺风车场景，司机和乘客都有自己原本的出发地和到达地，并且司机和乘客为预约出发，但是我们的顺路算法不用考虑实时性以及路况信息。因此我们将算法分成了几个部分：基础分、时间、顺路、绕路、方向。其中除了方向以为，其他的维度都有一个权重值，并且所有权重相加等于1。最终的分数计算公式为："></a>我们的需求当中，类似于顺风车场景，司机和乘客都有自己原本的出发地和到达地，并且司机和乘客为预约出发，但是我们的顺路算法不用考虑实时性以及路况信息。因此我们将算法分成了几个部分：基础分、时间、顺路、绕路、方向。其中除了方向以为，其他的维度都有一个权重值，并且所有权重相加等于1。最终的分数计算公式为：</h5><pre><code class="hljs"><div>总分数 = 基础分 + 时间分 + (顺路分 + 绕路分) * 方向
</div></code></pre>

<h3 id="基础、时间"><a href="#基础、时间" class="headerlink" title="基础、时间"></a>基础、时间</h3><h5 id="基础和时间是相对独立的分数计算。特别是基础分，我们给了一个固定值，以此来保证分数看起来相对稳定，因为用户对分数的敏感程度和算法之间会有一个差距，因此需要通过一个基础分数来平衡这种差距。"><a href="#基础和时间是相对独立的分数计算。特别是基础分，我们给了一个固定值，以此来保证分数看起来相对稳定，因为用户对分数的敏感程度和算法之间会有一个差距，因此需要通过一个基础分数来平衡这种差距。" class="headerlink" title="基础和时间是相对独立的分数计算。特别是基础分，我们给了一个固定值，以此来保证分数看起来相对稳定，因为用户对分数的敏感程度和算法之间会有一个差距，因此需要通过一个基础分数来平衡这种差距。"></a>基础和时间是相对独立的分数计算。特别是基础分，我们给了一个固定值，以此来保证分数看起来相对稳定，因为用户对分数的敏感程度和算法之间会有一个差距，因此需要通过一个基础分数来平衡这种差距。</h5><h5 id="时间分数也很简单，我们的逻辑是按照乘客的出发时间和司机的出发时间来匹配的，我们认为如果出发时间相差30分钟以上，则时间得分为0。出发时间相等则得到时间满分。"><a href="#时间分数也很简单，我们的逻辑是按照乘客的出发时间和司机的出发时间来匹配的，我们认为如果出发时间相差30分钟以上，则时间得分为0。出发时间相等则得到时间满分。" class="headerlink" title="时间分数也很简单，我们的逻辑是按照乘客的出发时间和司机的出发时间来匹配的，我们认为如果出发时间相差30分钟以上，则时间得分为0。出发时间相等则得到时间满分。"></a>时间分数也很简单，我们的逻辑是按照乘客的出发时间和司机的出发时间来匹配的，我们认为如果出发时间相差30分钟以上，则时间得分为0。出发时间相等则得到时间满分。</h5><h3 id="顺路、绕路、方向"><a href="#顺路、绕路、方向" class="headerlink" title="顺路、绕路、方向"></a>顺路、绕路、方向</h3><h5 id="其实这三个维度的分数计算才是描述两个行程是否相似的核心。司机和乘客行程路线可以简化为下图："><a href="#其实这三个维度的分数计算才是描述两个行程是否相似的核心。司机和乘客行程路线可以简化为下图：" class="headerlink" title="其实这三个维度的分数计算才是描述两个行程是否相似的核心。司机和乘客行程路线可以简化为下图："></a>其实这三个维度的分数计算才是描述两个行程是否相似的核心。司机和乘客行程路线可以简化为下图：</h5><p><img src="/img/arithmetic/scoreroute.png" alt="司机乘客行程简图"></p>
<h5 id="图中路线主要有以下几种："><a href="#图中路线主要有以下几种：" class="headerlink" title="图中路线主要有以下几种："></a>图中路线主要有以下几种：</h5><ol>
<li>司机假设行程：DS-DE</li>
<li>乘客行程：PS-PE</li>
<li>司机实际行程：DS-PS-PE-DE</li>
</ol>
<h4 id="顺路"><a href="#顺路" class="headerlink" title="顺路"></a>顺路</h4><h5 id="顺路即在整个行程当中，乘客的路线距离占比。"><a href="#顺路即在整个行程当中，乘客的路线距离占比。" class="headerlink" title="顺路即在整个行程当中，乘客的路线距离占比。"></a>顺路即在整个行程当中，乘客的路线距离占比。</h5><pre><code class="hljs"><div>顺路 = PS-PE / DS-PS-PE-DE
</div></code></pre>

<h5 id="因为PS-PE是包含在DS-PS-PE-DE中的，因此顺路计算出来的值为0-1之间。并且越接近1分数应该越高。"><a href="#因为PS-PE是包含在DS-PS-PE-DE中的，因此顺路计算出来的值为0-1之间。并且越接近1分数应该越高。" class="headerlink" title="因为PS-PE是包含在DS-PS-PE-DE中的，因此顺路计算出来的值为0-1之间。并且越接近1分数应该越高。"></a>因为PS-PE是包含在DS-PS-PE-DE中的，因此顺路计算出来的值为0-1之间。并且越接近1分数应该越高。</h5><h4 id="绕路"><a href="#绕路" class="headerlink" title="绕路"></a>绕路</h4><h5 id="绕路即在整个行程当中，司机的路线距离占比。"><a href="#绕路即在整个行程当中，司机的路线距离占比。" class="headerlink" title="绕路即在整个行程当中，司机的路线距离占比。"></a>绕路即在整个行程当中，司机的路线距离占比。</h5><pre><code class="hljs"><div>绕路 = DS-DE / DS-PS-PE-DE
</div></code></pre>

<h5 id="实际上DS-DE和DS-PS-PE-DE可以理解为两条完全不相关的路线，理论上来说绕路的分数值也在0-1之间，并且越接近1，则表示司机绕路越少。但是实际开发中，犹豫地图的实时性以及稳定性等因素，有可能会造成DS-DE的值大于DS-PS-PE-DE的值。因此通常可以采用重试、缓存（将正确的距离缓存，不用每次都实时获取）、默认值等方式去处理这种特殊的边界情况。"><a href="#实际上DS-DE和DS-PS-PE-DE可以理解为两条完全不相关的路线，理论上来说绕路的分数值也在0-1之间，并且越接近1，则表示司机绕路越少。但是实际开发中，犹豫地图的实时性以及稳定性等因素，有可能会造成DS-DE的值大于DS-PS-PE-DE的值。因此通常可以采用重试、缓存（将正确的距离缓存，不用每次都实时获取）、默认值等方式去处理这种特殊的边界情况。" class="headerlink" title="实际上DS-DE和DS-PS-PE-DE可以理解为两条完全不相关的路线，理论上来说绕路的分数值也在0-1之间，并且越接近1，则表示司机绕路越少。但是实际开发中，犹豫地图的实时性以及稳定性等因素，有可能会造成DS-DE的值大于DS-PS-PE-DE的值。因此通常可以采用重试、缓存（将正确的距离缓存，不用每次都实时获取）、默认值等方式去处理这种特殊的边界情况。"></a>实际上DS-DE和DS-PS-PE-DE可以理解为两条完全不相关的路线，理论上来说绕路的分数值也在0-1之间，并且越接近1，则表示司机绕路越少。但是实际开发中，犹豫地图的实时性以及稳定性等因素，有可能会造成DS-DE的值大于DS-PS-PE-DE的值。因此通常可以采用重试、缓存（将正确的距离缓存，不用每次都实时获取）、默认值等方式去处理这种特殊的边界情况。</h5><h4 id="方向"><a href="#方向" class="headerlink" title="方向"></a>方向</h4><h5 id="方向则表示DS-DE和PS-PE两条直线之间的角度，方向的区间为-0-180-，越接近0得分应该越高。但是分数没有单独拿出来分配权重，而是作为顺路和绕路的一个辅助因数，使得顺路和绕路的计算更加丰富，可调节的程度更多一些。"><a href="#方向则表示DS-DE和PS-PE两条直线之间的角度，方向的区间为-0-180-，越接近0得分应该越高。但是分数没有单独拿出来分配权重，而是作为顺路和绕路的一个辅助因数，使得顺路和绕路的计算更加丰富，可调节的程度更多一些。" class="headerlink" title="方向则表示DS-DE和PS-PE两条直线之间的角度，方向的区间为[0,180]，越接近0得分应该越高。但是分数没有单独拿出来分配权重，而是作为顺路和绕路的一个辅助因数，使得顺路和绕路的计算更加丰富，可调节的程度更多一些。"></a>方向则表示DS-DE和PS-PE两条直线之间的角度，方向的区间为[0,180]，越接近0得分应该越高。但是分数没有单独拿出来分配权重，而是作为顺路和绕路的一个辅助因数，使得顺路和绕路的计算更加丰富，可调节的程度更多一些。</h5><h3 id="分数的分布"><a href="#分数的分布" class="headerlink" title="分数的分布"></a>分数的分布</h3><h5 id="前面介绍了时间、顺路、绕路、方向等计算公式，他们都可以将结果转换为0-1之间的小数。那么如何将分数分布在这些区间之内呢？均匀分布？分段分布？"><a href="#前面介绍了时间、顺路、绕路、方向等计算公式，他们都可以将结果转换为0-1之间的小数。那么如何将分数分布在这些区间之内呢？均匀分布？分段分布？" class="headerlink" title="前面介绍了时间、顺路、绕路、方向等计算公式，他们都可以将结果转换为0-1之间的小数。那么如何将分数分布在这些区间之内呢？均匀分布？分段分布？"></a>前面介绍了时间、顺路、绕路、方向等计算公式，他们都可以将结果转换为0-1之间的小数。那么如何将分数分布在这些区间之内呢？均匀分布？分段分布？</h5><h5 id="这里说一下分数分布的重要性，比如时间，出发时间完全相等是非常难的，通常来说，用户会觉得相差10分钟以内都是相似度很高的。以及方向，我们计算的方向是按照直线的角度来算的，如果出现以下情况，长的线段和短的线段直接是有大概20度的角度差，但是短线段所在的点正在司机回家的路过点，这种情况通常来说顺路分数应该相对高一些。因此我们应该减小小角度的影响范围。"><a href="#这里说一下分数分布的重要性，比如时间，出发时间完全相等是非常难的，通常来说，用户会觉得相差10分钟以内都是相似度很高的。以及方向，我们计算的方向是按照直线的角度来算的，如果出现以下情况，长的线段和短的线段直接是有大概20度的角度差，但是短线段所在的点正在司机回家的路过点，这种情况通常来说顺路分数应该相对高一些。因此我们应该减小小角度的影响范围。" class="headerlink" title="这里说一下分数分布的重要性，比如时间，出发时间完全相等是非常难的，通常来说，用户会觉得相差10分钟以内都是相似度很高的。以及方向，我们计算的方向是按照直线的角度来算的，如果出现以下情况，长的线段和短的线段直接是有大概20度的角度差，但是短线段所在的点正在司机回家的路过点，这种情况通常来说顺路分数应该相对高一些。因此我们应该减小小角度的影响范围。"></a>这里说一下分数分布的重要性，比如时间，出发时间完全相等是非常难的，通常来说，用户会觉得相差10分钟以内都是相似度很高的。以及方向，我们计算的方向是按照直线的角度来算的，如果出现以下情况，长的线段和短的线段直接是有大概20度的角度差，但是短线段所在的点正在司机回家的路过点，这种情况通常来说顺路分数应该相对高一些。因此我们应该减小小角度的影响范围。</h5><p><img src="/img/arithmetic/scoreroute1.png" alt="司机乘客行程简图"></p>
<h5 id="相应的场景还有很多，比如顺路比，如果司机在回家的路上刚好路过乘客的起终点，那么尽管乘客的行程距离很短，我们也应该给出较高的分数。"><a href="#相应的场景还有很多，比如顺路比，如果司机在回家的路上刚好路过乘客的起终点，那么尽管乘客的行程距离很短，我们也应该给出较高的分数。" class="headerlink" title="相应的场景还有很多，比如顺路比，如果司机在回家的路上刚好路过乘客的起终点，那么尽管乘客的行程距离很短，我们也应该给出较高的分数。"></a>相应的场景还有很多，比如顺路比，如果司机在回家的路上刚好路过乘客的起终点，那么尽管乘客的行程距离很短，我们也应该给出较高的分数。</h5><h5 id="那么我们是如何去控制和调节这些分数的分布的呢，分段分布是一种解决方法，但是力度不够细，段的多少很难控制，以及段内的分布呢？我们的解决办法很简单，通过幂次方来控制。"><a href="#那么我们是如何去控制和调节这些分数的分布的呢，分段分布是一种解决方法，但是力度不够细，段的多少很难控制，以及段内的分布呢？我们的解决办法很简单，通过幂次方来控制。" class="headerlink" title="那么我们是如何去控制和调节这些分数的分布的呢，分段分布是一种解决方法，但是力度不够细，段的多少很难控制，以及段内的分布呢？我们的解决办法很简单，通过幂次方来控制。"></a>那么我们是如何去控制和调节这些分数的分布的呢，分段分布是一种解决方法，但是力度不够细，段的多少很难控制，以及段内的分布呢？我们的解决办法很简单，通过幂次方来控制。</h5><p><img src="/img/arithmetic/scoreroute2.jpeg" alt="司机乘客行程简图"></p>
<h5 id="以上为公式Math-pow-x-t-的走势，从左往右t的大小依次为0-2、0-6、1、1-8、5。x值为区间值，也就是-0-1-，y等于x的分数映射，也就是分数分布结果。可以看到："><a href="#以上为公式Math-pow-x-t-的走势，从左往右t的大小依次为0-2、0-6、1、1-8、5。x值为区间值，也就是-0-1-，y等于x的分数映射，也就是分数分布结果。可以看到：" class="headerlink" title="以上为公式Math.pow(x,t)的走势，从左往右t的大小依次为0.2、0.6、1、1.8、5。x值为区间值，也就是[0,1]，y等于x的分数映射，也就是分数分布结果。可以看到："></a>以上为公式Math.pow(x,t)的走势，从左往右t的大小依次为0.2、0.6、1、1.8、5。x值为区间值，也就是[0,1]，y等于x的分数映射，也就是分数分布结果。可以看到：</h5><ol>
<li>t=1，为线性增长</li>
<li>t&lt;1，分数的分布重心在x的前半段</li>
<li>t&gt;1，分数的分布重心在x的后半段</li>
</ol>
<h5 id="举个例子，在我们的应用中，方向的t设置为0-3。则当两条路线的角度为90度时，y的值大概等于0-8。我们认为这是一个相对合理的得分。"><a href="#举个例子，在我们的应用中，方向的t设置为0-3。则当两条路线的角度为90度时，y的值大概等于0-8。我们认为这是一个相对合理的得分。" class="headerlink" title="举个例子，在我们的应用中，方向的t设置为0.3。则当两条路线的角度为90度时，y的值大概等于0.8。我们认为这是一个相对合理的得分。"></a>举个例子，在我们的应用中，方向的t设置为0.3。则当两条路线的角度为90度时，y的值大概等于0.8。我们认为这是一个相对合理的得分。</h5><h5 id="这个只是比较粗糙的分布，我们可以更加细致将x区间分成多段，然后在每个段内设置不同的t参数以及y的起终点，达到相对连续平滑的复杂分布效果。"><a href="#这个只是比较粗糙的分布，我们可以更加细致将x区间分成多段，然后在每个段内设置不同的t参数以及y的起终点，达到相对连续平滑的复杂分布效果。" class="headerlink" title="这个只是比较粗糙的分布，我们可以更加细致将x区间分成多段，然后在每个段内设置不同的t参数以及y的起终点，达到相对连续平滑的复杂分布效果。"></a>这个只是比较粗糙的分布，我们可以更加细致将x区间分成多段，然后在每个段内设置不同的t参数以及y的起终点，达到相对连续平滑的复杂分布效果。</h5><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><h5 id="上面分析了算法的基本原理已经实现中一些问题的解决方案，该算法主要有优缺点："><a href="#上面分析了算法的基本原理已经实现中一些问题的解决方案，该算法主要有优缺点：" class="headerlink" title="上面分析了算法的基本原理已经实现中一些问题的解决方案，该算法主要有优缺点："></a>上面分析了算法的基本原理已经实现中一些问题的解决方案，该算法主要有优缺点：</h5><h4 id="优点："><a href="#优点：" class="headerlink" title="优点："></a>优点：</h4><ol>
<li>算法简单易懂，容易理解，容易实现</li>
<li>可调节范围还是挺多的，对于各种应用场景都能相对兼容</li>
</ol>
<h4 id="缺点："><a href="#缺点：" class="headerlink" title="缺点："></a>缺点：</h4><ol>
<li>比较依赖地图给出的路面距离，在实际应用中可能误差较大</li>
</ol>
</div>
    </article>
</section>

<div class="clear"></div>



    <footer id="footer">
  <div class="foot">
    <!-- <a id="gotop">TOP</a> -->
    <!-- <div id="copyright">Copyright &copy; 2016 <a href="#" target="_blank">WangWenXiang</a><br>
       Power by <a href="https://github.com/winx402" target="_blank">Github Pages</a> |
      <a href="https://hexo.io/" target="_blank">HEXO</a></div> -->
      <div id="copyright">还没想好要写什么</div>
  </div>
</footer>

</div>
<div class="img-view">
    <span><img src="/img/guide.jpeg"></span>
</div>
<script type="text/javascript" src="/js/base.js"></script>
<script type="text/javascript" async
            src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
    </script>
<link rel="stylesheet" href="//cdn.bootcss.com/highlight.js/9.2.0/styles/github.min.css">
<script src="//cdn.bootcss.com/highlight.js/9.2.0/highlight.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>
</body>
</html>
