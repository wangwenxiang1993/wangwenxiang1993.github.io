---
layout: post
title: river工具介绍
date: 2017/06/02
original: true
tags: [tech, river, index]
---

##### 　　river是一个java工具包，是对java的method的增强。在原有的method调用流程不变的情况下，尽可能用注解去增强目标方法的灵活性。river希望做的是解耦java method 之间的调用关系。实现代码无侵入或者少侵入的流程控制。
<!--more-->

#### github地址：[river](https://github.com/winx402/river)

## river基础
##### river是通过cglib动态代理作为基础来实现的，这里并没有使用jdk自带的代理方式实现。

## river现有功能
### aop
##### 　　aop是一个比较典型的例子，aop实现在目标方法之前、之后、异常等情况下的代码插入。这些插入的代码可以做类似于日志记录，流量统计等工作。也可以在before代码中修改目标方法参数，在after中修改目标方法返回值。但是没有办法控制目标方法是否继续（除非抛出异常）。

### 缓存
##### 　　cache显而易见，是对目标方法结果的缓存，在缓存结果有效期内，新的调用并不会去执行目标方法，而是直接拿缓存结果。并且用户可以自定义缓存的key（从入参中选取一部分参数，或者是某个对象中的某些属性来作为缓存的key）。
### 限流
##### 　　rate limit是对目标方法每秒的调用频率的限制。在限制的流量内，调用会非常顺畅。在超出的流量之外，调用会阻塞，直到新的调用机会。此外，也可以设置超时时间，如果有超时时间设置，在调用之前会先检查在超时时间内能否拿到调用的机会，如果不能，直接返回超时异常。
### 线程池
##### 　　目标方法会用新的线程去执行。可以理解成方法之间的异步执行，如果返回值是void或者是指定的类型。其他的返回值类型，虽然启用的新的线程去执行，但是会等待线程执行完成后拿到返回值再返回。
### around
##### 　　around是最灵活的，around是现在river的功能的核心，around可以在A方法调用B方法之间插入C方法。C方法就叫做对B的around，C可以拿到B的入参、返回、method对象等，也可以控制调用B方法的时机，甚至是不调用。实际上，上面的各种功能的实现都可以用around自己实现，但是实现以上功能的成本对于普通使用者来说成本太高也没有必要。因此一些核心且重要的功能都已经单独实现，只需要使用相应的注解就可以了